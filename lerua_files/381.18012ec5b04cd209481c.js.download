(window.webpackJsonp=window.webpackJsonp||[]).push([[381],{1014:function(t,e,r){"use strict";r.r(e);var s=r(14),n=r(19),c=r.n(n),o=r(5),i=r.n(o),a=r(20),d=r(388),l=r(4),u=r(389);function h(){const t=c()(["<slot></slot>"]);return h=function(){return t},t}function j(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,s)}return r}const m={agreement:{type:Boolean},variant:{type:Number,attribute:"variant"},_lastState:{type:Boolean}},P=Object.prototype.hasOwnProperty;class _ extends a.a{static get properties(){return m}constructor(){super(),this.activeProject=null,this.productsInBasket=null,this.variant=null,this._lastState=null,this.currProjectProducts=[]}updated(t){if(t.has("variant")&&1===this.variant){const t=document.querySelector("uc-cbf-facing-buttons-menu");t&&(t.style.display="none");const e=document.querySelector("uc-catalog");e&&e.setAttribute("show-navigation-tiles",""),this._initializeModal()}}getCurrentProject(){this.currProjectProducts=Object(u.f)(this.activeProject)||[],this.countProducts=this.currProjectProducts.length}_initializeModal(){this.activeProject=this._getActiveProject(),this.activeProject&&(this.getCurrentProject(),this.agreement=this._getAgreementState(),this._lastState=this._getLastState(),this._getAllProductsModelsFromBasket().then(()=>this._setDataForModal())),this._modalElement=this.querySelector("uc-project-navigation-modal"),this._setAgreementState=this._setAgreementState.bind(this),document.addEventListener(d.e,this._setAgreementState),this._setLastState=this._setLastState.bind(this),document.addEventListener(d.g,this._setLastState),this._addProduct=this._addProduct.bind(this),document.body.addEventListener(l.a,this._addProduct),this._deleteProduct=this._deleteProduct.bind(this),document.body.addEventListener(l.b,this._deleteProduct)}_getAllProductsModelsFromBasket(){return l.c.getAll().then(t=>this._allProductsInBasket=t.map(t=>+t))}disconnectedCallback(){document.body.removeEventListener(l.a,this._addProduct),document.body.removeEventListener(l.b,this._deleteProduct),document.removeEventListener(d.e,this._setAgreementState),document.removeEventListener(d.g,this._setLastState),super.disconnectedCallback()}_getLastState(){return Object(u.d)(d.f)}_setLastState(t){const{currValue:e}=t.detail;this._lastState=e,Object(u.j)(d.f,e)}_setAgreementState(t){const{currValue:e,currProject:r}=t.detail,s=Object(u.d)(d.d)||{};let n;switch(e){case!0:n="agree";break;case!1:n="disagree";break;case null:n="unclear"}const c=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?j(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},s,{[r]:n});this.agreement=e,Object(u.j)(d.d,c)}_setActiveProject(){Object(u.j)(d.b,this.activeProject)}_addProduct(t){let{modelId:e}=t.detail;if(e)if(e=+e,this.activeProject){const t=Object(u.c)(e,this.currProjectProducts);if(Object(u.b)(e,this.productsInBasket)||!(null==t?void 0:t.length))return;this.productsInBasket=[...this.productsInBasket,t],this._modalElement.addedProduct=e,this._modalElement.productsInBasket=this.productsInBasket}else{const t=Object(u.h)(e);if(1===t.length){const[e]=t;e!==this.activeProject&&(this.activeProject=e,this.getCurrentProject()),this._getAllProductsModelsFromBasket().then(()=>this._setDataForModal(!0))}}}_deleteProduct(t){if(!this.activeProject)return;let{modelId:e}=t.detail;e&&(e=+e,Object(u.b)(e,this.productsInBasket)&&this._getAllProductsModelsFromBasket().then(()=>{this.productsInBasket=Object(u.g)(this._allProductsInBasket,this.currProjectProducts),this._modalElement.productsInBasket=this.productsInBasket}))}_getAgreementState(){const t=Object(u.d)(d.d);if(t&&P.call(t,this.activeProject)){const e=t[this.activeProject];return"disagree"!==e&&("agree"===e||null)}return this._setAgreementState({detail:{currValue:null,currProject:this.activeProject}}),null}_getActiveProject(){return Object(u.d)(d.b)}_setDataForModal(t=!1){this.activeProject&&(t&&(this.agreement=null,this._setActiveProject(),this._setAgreementState({detail:{currValue:null,currProject:this.activeProject}})),this.productsInBasket=Object(u.g)(this._allProductsInBasket,this.currProjectProducts),this._turnOnModal(t))}_defineIsFullModal(t,e){return!(!t&&!e)&&(null===this.agreement||this.agreement)}_defineIsTurnOnWrapper(t,e){return!(!t&&!e)&&null===this.agreement}_turnOnModal(t){this._modalElement.projectToDisplay=this.activeProject,this._modalElement.agreement=this.agreement,this._modalElement.productsInBasket=this.productsInBasket,this._modalElement.totalCount=this.countProducts,this._modalElement.turnOnModal=!0;const e=Object(u.d)(d.a);this._modalElement.fullModal=this._defineIsFullModal(t,e),this._modalElement.turnOnWrapper=this._defineIsTurnOnWrapper(t,e),Object(u.j)(d.a,!1)}render(){return Object(a.c)(h())}}Object(s.b)("uc-project-navigation-modal-control",_)}}]);